import requests
from .. import SoftwareForAnalyze, Vulnerability

class NVD:

    @staticmethod
    def check_vulnerabilities(software: SoftwareForAnalyze) -> list[Vulnerability]:
        URL = "https://services.nvd.nist.gov/rest/json/cves/2.0"

        params = {
            "keywordSearch": f"{software.package} {software.version}",
            "resultsPerPage": 5
        }

        response = requests.get(URL, params=params)

        if response.status_code != 200:
            return []

        data = response.json()
        raw_vulnerabilities = data.get("vulnerabilities", [])

        if not raw_vulnerabilities:
            return []

        vulnerabilities: list[Vulnerability] = []
        for vuln in raw_vulnerabilities:
            vulnerabilities.append(Vulnerability(
                id=vuln["cve"]["id"],
                description=vuln["cve"]["descriptions"][0]["value"],
                more_info=str([ref["url"] for ref in vuln["cve"].get("references", [])])
            ))

        return vulnerabilities
